{#{% form_theme form 'bootstrap_4_layout.html.twig' %}#}
{#{% form_theme form 'bootstrap_4_horizontal_layout.html.twig' %}#}
{% extends 'layout_admin.html.twig' %}

{% block title %}
    Start import, step2 :: admin
{% endblock %}

{% block breadcrumbs %}
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a href="{{ path('backend_dashboard') }}"><i class="fa fa-dashboard"></i>  Dashboard</a>
        </li>
        <li class="breadcrumb-item">
            <a href="{{ path('backend_import_index') }}"><i class="fa fa-table"></i> YML Imports</a>
        </li>
        <li class="breadcrumb-item">
            <a href="{{ path('backend_import_step1', {'id': row.id}) }}"><i
                        class="fa fa-pencil"></i> Import Step2</a>
        </li>
    </ol>
{% endblock %}

{% block body %}
    <style>
        .table-responsive{
            height: 600px;
            overflow: scroll;
        }
        thead tr:nth-child(1) th{
            color: #fff;
            background-color: #343a40;
            position: sticky;
            top: 0;
            z-index: 10;
        }
    </style>

    <form method="post" action="{{ path('backend_import_step2', {'id': row.id}) }}">
        <h3>Import / step2 / parse CSV file
            <a class="btn btn-secondary" href="{{ path('backend_import_step1', {'id': row.id}) }}">
                <i class="fa fa-arrow-left"></i> Back to step2</a>
            <button class="btn btn-primary" type="submit"><i class="fa fa-check"></i> Update</button>
            <button class="btn btn-success" type="submit" name="next">
                <i class="fa fa-arrow-right"></i> Next to step3</button>

        </h3>
        <hr />

        {% include 'admin/flashes.html.twig' %}

        <h2>Map Countries</h2>
        <table class="table table-striped table-bordered">
            {% for id, ymlCountry in ymlCountries %}
                {% set found = false %}
                <tr>
                    <td>{{ id }}</td>
                    <td>{{ ymlCountry.name }}</td>
                    <td><select name="country[{{ id }}]" id="">
                            <option value="">---</option>
                            {% set ymlCountryLC = ymlCountry.name | lower %}
                            {% for c_id, c_name in inDbCountries %}
                                {% set inDbCountryLC = c_name | lower %}
                                {% if ymlCountryLC in inDbCountryLC %}
                                    {% set found = true %}
                                {% endif %}
                                <option value="{{ inDbCountryLC }}"{{ ymlCountryLC in inDbCountryLC ? ' selected' : '' }}>{{ c_name }}</option>
                            {% endfor %}
                        </select>
                        {% if found == false %}
                            <input type="checkbox" name="newCountry[{{ id }}]" id="new_country_{{ id }}">
                            <label for="new_country_{{ id }}">add this</label>
                        {% endif %}

                    </td>
                </tr>
            {% endfor %}

        </table>

        <h2>Map Regions</h2>
        <table class="table table-striped table-bordered">
            {% for id, ymlRegion in ymlRegions %}
                {% set found = false %}
                <tr>
                    <td>{{ id }}</td>
                    <td>({{ ymlRegion.country_name }}) - {{ ymlRegion.name }}</td>
                    <td><select name="country[{{ id }}]" id="">
                            <option value="">---</option>
                            {% set ymlRegionLC = ymlRegion.name | lower %}
                            {% for c_id, c_name in inDbRegions %}
                                {% set inDbRegionLC = c_name | lower %}
                                {% if ymlRegionLC in inDbRegionLC %}
                                    {% set found = true %}
                                {% endif %}
                                <option value="{{ inDbRegionLC }}"{{ ymlRegionLC in inDbRegionLC ? ' selected' : '' }}>{{ c_name }}</option>
                            {% endfor %}
                        </select>
                        {% if found == false %}
                            <input type="checkbox" name="newRegion[{{ id }}]" id="new_region_{{ id }}">
                            <label for="new_country_{{ id }}">add this</label>
                        {% endif %}

                    </td>
                </tr>
            {% endfor %}

        </table>

        <h2>Map Vendors</h2>
        <table class="table table-striped table-bordered">
            {% for id, vendor in vendors %}
                {% set found = false %}
                <tr>
                    <td>{{ id }}</td>
                    <td>({{ vendor.country_name }}{{ vendor.region_name }}) {{ vendor.name | raw }}</td>
                    <td><select name="vendor[{{ id }}]" id="vendor_{{ id }}">
                            <option value="">---</option>
                            {% for v_id, v_name in allVendors %}
                                {% if vendor.name == v_name %}
                                    {% set found = true %}
                                {% endif %}
                                <option value="{{ v_id }}"{{ vendor.name == v_name ? ' selected' : '' }}>{{ v_name }}</option>
                            {% endfor %}
                        </select>
                        {% if found == false %}
                        <input type="checkbox" name="newVendor[{{ id }}]" id="new_vendor_{{ id }}">
                        <label for="new_vendor_{{ id }}">add this</label>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </table>


{#        <div class="table-responsive">#}
{#            <table class="table table-bordered table-striped">#}
{#                <thead>#}
{#                    <tr>#}
{#                        <th>#</th>#}
{#                        <th>Столбец в CSV</th>#}
{#                        <th>Значение</th>#}
{#                        <th>Поле в базе</th>#}
{#                    </tr>#}
{#                </thead>#}
{#                {% for columnNum, columnName in exampleDataRow %}#}
{#                    <tr id="row_{{ columnNum }}">#}
{#                        <td width="1">#}
{#                            <a href="javascript:;" class="delete_row" rel="row_{{ columnNum }}"><span#}
{#                                        class="badge badge-pill badge-danger"><i class="fa fa-window-close"></i></span></a>#}
{#                        </td>#}
{#                        <td width="1" class="text-nowrap">#}
{#                            <input type="hidden" name="csvColNum[]" value="{{ id }}">#}
{#                            {{ headerArr[columnNum] is defined ? headerArr[columnNum] : '---'}}#}
{#                        </td>#}
{#                        <td width="1" class="text-nowrap">{{ columnName }}</td>#}
{#                        <td>#}
{#                            <select name="csvColumnMapping[{{ columnNum }}]">#}
{#                                <option value=""></option>#}
{#                                {% for fieldLabel, fieldName in importFields %}#}
{#                                    {% set selected = csvColumnMapping[columnNum] is defined and csvColumnMapping[columnNum] == fieldName ? 1 : 0 %}#}
{#                                    <option value="{{ fieldName }}" {{ selected == 1 ? ' selected="selected"' : '' }}>{{ fieldLabel }}</option>#}
{#                                {% endfor %}#}
{#                            </select>#}
{#                        </td>#}
{#                    </tr>#}
{#                {% endfor %}#}
{#            </table>#}
{#        </div>#}
    </form>

    {#    {{ form_start(form) }}#}
{#    {{ form_rest(form) }}#}
{#    {{ form_end(form) }}#}


    <br />

    <script>
        $(document).ready(function () {
            $('.delete_row').on('click', function (e) {
                var rel = $(this).attr('rel');
                var $this = $(this);
                // console.log('remove ' + rel);
                $('#' + rel).addClass('alert-danger');
                setTimeout(function() {
                    $('#'+rel).remove();
                    console.log('remove ' + rel);
                }, 200);

            })
        })
    </script>
{% endblock %}
